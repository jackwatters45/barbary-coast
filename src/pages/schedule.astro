---
import Layout from "../layouts/Layout.astro";
import ScheduleList from "../components/Schedule.astro";
import Standings from "../components/Standings.astro";
import ulaxData from "../data/ulax.json";
import type { UlaxGameSerialized, UlaxStanding, UlaxAllDataSerialized } from "../lib/ulax";

const data = ulaxData as UlaxAllDataSerialized;
const season = data.currentSeason;
const seasonData = data.seasons[season];

// ULAX games from synced data (cast to restore union literal types lost in JSON)
const ulaxGames = (seasonData?.schedule ?? []) as UlaxGameSerialized[];
const standings = (seasonData?.standings ?? []) as UlaxStanding[];
const fetchedAt = new Date(data.fetchedAt);

// Additional non-ULAX events (practices, scrimmages, tournaments)
const otherEvents = [
  {
    date: "2025-10-31",
    time: "TBD",
    type: "tournament" as const,
    name: "Hawaii Halloween Tournament",
    location: "Honolulu, HI",
  },
];
---

<Layout title="Schedule" description="View upcoming games, standings, and results for Barbary Coast Lacrosse.">
  <!-- Page Header -->
  <section class="pt-12 pb-8">
    <div class="max-w-5xl mx-auto px-4">
      <span class="label text-muted">ULAX {season.charAt(0).toUpperCase() + season.slice(1)} 2026</span>
      <h1 class="text-3xl sm:text-4xl text-foreground mt-2">Schedule & Results</h1>
      <p class="text-muted text-sm mt-2">
        Data synced from <a href="https://ulax.org/sanfrancisco/men/winter/" class="underline hover:text-foreground">ulax.org</a>
      </p>
    </div>
  </section>

  <!-- Legend -->
  <section class="pb-4">
    <div class="max-w-4xl mx-auto px-4">
      <div class="flex flex-wrap gap-x-6 gap-y-2 text-sm">
        <div class="flex gap-2">
          <span class="label text-gold">[league]</span>
          <span class="label text-gold">[tournament]</span>
          <span class="label text-powder-dark">[practice]</span>
          <span class="label text-subtle">[scrimmage]</span>
        </div>
        <div class="flex gap-2">
          <span class="label text-green-600">[playoffs]</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Schedule List -->
  <section class="pb-12">
    <div class="max-w-4xl mx-auto px-4">
      <ScheduleList ulaxGames={ulaxGames} events={otherEvents} barbaryCoastOnly={true} />

      <p class="text-subtle text-sm text-center mt-6 font-mono">
        // last updated {fetchedAt.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" })}
      </p>
    </div>
  </section>

  <!-- Standings -->
  <section class="py-12 border-t border-border">
    <div class="max-w-4xl mx-auto px-4">
      <h2 class="text-xl sm:text-2xl text-foreground mb-4">Standings</h2>
      <div class="bg-white border border-border p-4 sm:p-6">
        <Standings standings={standings} />
      </div>
    </div>
  </section>

  <!-- Practice Info -->
  <section class="py-12 border-t border-border">
    <div class="max-w-4xl mx-auto px-4">
      <h2 class="text-xl sm:text-2xl text-foreground mb-6">Practice Info</h2>

      <div class="grid sm:grid-cols-2 gap-4">
        <div class="bg-white border border-border p-5">
          <span class="label text-muted">When</span>
          <ul class="mt-2 space-y-1 text-text text-sm">
            <li>Tuesdays, 7:00 PM – 9:00 PM</li>
            <li>Thursdays, 7:00 PM – 9:00 PM</li>
          </ul>
        </div>

        <div class="bg-white border border-border p-5">
          <span class="label text-muted">Where</span>
          <p class="text-text mt-2">Beach Chalet Fields</p>
          <p class="text-muted text-sm mt-1">
            1000 Great Highway, SF 94121
          </p>
        </div>
      </div>

      <div class="mt-8 text-center">
        <a
          href="/contact"
          class="inline-flex items-center justify-center px-5 py-2.5 border border-border text-foreground font-mono text-xs font-medium tracking-wide transition-colors hover:bg-foreground/5"
        >
          Questions? →
        </a>
      </div>
    </div>
  </section>
</Layout>
