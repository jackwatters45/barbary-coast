---
import Layout from "../layouts/Layout.astro";
import Schedule from "../components/Schedule.astro";
import ulaxData from "../data/ulax.json";
import { manualEvents } from "../data/events";
import type { UlaxGameSerialized, UlaxAllDataSerialized } from "../lib/ulax";

const data = ulaxData as UlaxAllDataSerialized;
const season = data.currentSeason;
const seasonData = data.seasons[season];
const ulaxGames = (seasonData?.schedule ?? []) as UlaxGameSerialized[];
---

<Layout title="Home" showSectionNav={true}>
  <!-- Custom lacrosse ball cursor -->
  <div id="ball-cursor" class="pointer-events-none fixed z-50 -translate-x-1/2 -translate-y-1/2 opacity-0 transition-opacity duration-200" aria-hidden="true">
    <div class="cursor-inner w-5 h-5 rounded-full bg-white border border-black/30 shadow-[0_0_10px_rgba(255,255,255,0.3)] transition-all duration-200"></div>
    <div class="cursor-ring absolute inset-0 -m-2 rounded-full border-2 border-white/50 opacity-0 scale-50 transition-all duration-200"></div>
  </div>
  <style>
    /* Hide cursor everywhere */
    :global(body.custom-cursor),
    :global(body.custom-cursor *) {
      cursor: none !important;
    }
    #ball-cursor.hovering .cursor-inner {
      transform: scale(1.4);
    }
    #ball-cursor.hovering .cursor-ring {
      opacity: 1;
      transform: scale(1);
    }
    #ball-cursor.pressing .cursor-inner {
      transform: scale(1);
    }
    #ball-cursor.pressing .cursor-ring {
      opacity: 0;
      transform: scale(0.5);
    }
  </style>

  <!-- Hero -->
  <section id="hero" class="snap-section section-full relative overflow-hidden">
    <!-- Blueprint grid background -->
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <!-- Major grid lines -->
      <div class="absolute top-0 left-1/4 w-px h-full bg-powder/10"></div>
      <div class="absolute top-0 left-2/4 w-px h-full bg-powder/10"></div>
      <div class="absolute top-0 left-3/4 w-px h-full bg-powder/10"></div>
      <div class="absolute top-1/4 left-0 w-full h-px bg-powder/10"></div>
      <div class="absolute top-2/4 left-0 w-full h-px bg-powder/10"></div>
      <div class="absolute top-3/4 left-0 w-full h-px bg-powder/10"></div>
      <!-- Minor grid lines for blueprint effect -->
      <div class="absolute top-0 left-[12.5%] w-px h-full bg-powder/5"></div>
      <div class="absolute top-0 left-[37.5%] w-px h-full bg-powder/5"></div>
      <div class="absolute top-0 left-[62.5%] w-px h-full bg-powder/5"></div>
      <div class="absolute top-0 left-[87.5%] w-px h-full bg-powder/5"></div>
    </div>

    <!-- Corner reference marks -->
    <div class="absolute top-8 right-8 w-8 h-8 border-t border-r border-powder/30 hidden lg:block" aria-hidden="true"></div>
    <div class="absolute bottom-8 left-8 w-8 h-8 border-b border-l border-powder/30 hidden lg:block" aria-hidden="true"></div>

    <div class="max-w-6xl mx-auto px-6 lg:px-16 relative">
      <div>
        <!-- Technical reference number -->
        <span class="label text-powder/60 block mb-2">ref. 001</span>
        <span class="label text-powder block mb-6">[club]</span>

        <h1 class="text-5xl sm:text-7xl lg:text-8xl font-semibold tracking-tight text-foreground">
          Barbary Coast
        </h1>

        <div class="mt-8 space-y-1">
          <p class="text-xl sm:text-2xl text-muted">San Francisco</p>
          <p class="text-xl sm:text-2xl text-muted">Men's Lacrosse</p>
        </div>

        <div class="mt-16">
          <span class="label text-gold">[est. 2024]</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Schedule Section -->
  <section id="schedule" class="snap-section section-full relative overflow-hidden">
    <!-- Background pattern - TBD -->
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
    </div>

    <!-- Corner L-brackets -->
    <div class="absolute top-8 left-8 w-8 h-8 border-t border-l border-powder/30 hidden lg:block" aria-hidden="true"></div>
    <div class="absolute bottom-8 right-8 w-8 h-8 border-b border-r border-powder/30 hidden lg:block" aria-hidden="true"></div>

    <div class="max-w-6xl mx-auto px-6 lg:px-16 relative">
      <div class="flex flex-col lg:flex-row lg:items-start gap-16">
        <!-- Left: Header -->
        <div class="lg:w-1/3 reveal">
          <span class="label text-powder/60 block mb-2">ref. 002</span>
          <span class="label text-powder">[upcoming]</span>
          <h2 class="text-foreground mt-2 text-4xl sm:text-5xl font-medium tracking-tight">Games</h2>
          <p class="text-muted mt-4 text-lg">
            Next matches for the team.
          </p>
          <a href="/schedule" class="subtle-link mt-6 inline-block">Full schedule →</a>
        </div>

        <!-- Right: Schedule cards -->
        <div class="lg:w-2/3 reveal" style="--delay: 0.1s">
          <Schedule ulaxGames={ulaxGames} events={manualEvents} barbaryCoastOnly={true} upcomingOnly={true} limit={4} />
        </div>
      </div>
    </div>
  </section>

  <!-- Practice Section -->
  <section id="practice" class="snap-section section-full relative overflow-hidden">
    <!-- Blueprint grid background - powder theme -->
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <!-- Vertical grid lines -->
      <div class="absolute top-0 left-[10%] w-px h-full bg-powder/12"></div>
      <div class="absolute top-0 left-[35%] w-px h-full bg-powder/18"></div>
      <div class="absolute top-0 left-[60%] w-px h-full bg-powder/18"></div>
      <div class="absolute top-0 left-[85%] w-px h-full bg-powder/12"></div>
      <!-- Horizontal grid lines -->
      <div class="absolute top-[15%] left-0 w-full h-px bg-powder/12"></div>
      <div class="absolute top-[45%] left-0 w-full h-px bg-powder/18"></div>
      <div class="absolute top-[75%] left-0 w-full h-px bg-powder/12"></div>
    </div>

    <!-- Corner L-brackets -->
    <div class="absolute top-8 right-8 w-8 h-8 border-t border-r border-powder/30 hidden lg:block" aria-hidden="true"></div>
    <div class="absolute bottom-8 left-8 w-8 h-8 border-b border-l border-powder/30 hidden lg:block" aria-hidden="true"></div>

    <div class="max-w-6xl mx-auto px-6 lg:px-16 relative">
      <div class="grid lg:grid-cols-2 gap-12">
        <div class="reveal">
          <span class="label text-powder/60 block mb-2">ref. 003</span>
          <span class="label text-gold">[weekly]</span>
          <h2 class="text-foreground mt-2 text-4xl sm:text-5xl font-medium tracking-tight">Practice</h2>

          <div class="mt-6">
            <p class="text-4xl sm:text-5xl font-medium text-foreground">
              Wednesdays
            </p>
            <p class="text-2xl text-muted mt-2">8–9 PM</p>
          </div>

          <div class="mt-8">
            <a
              href="https://www.google.com/maps/search/?api=1&query=Beach+Chalet+Fields+SF"
              target="_blank"
              rel="noopener"
              class="text-lg text-muted hover:text-foreground transition-colors"
            >
              Beach Chalet Fields, SF →
            </a>
          </div>
        </div>

        <div class="reveal flex items-center" style="--delay: 0.1s">
          <div class="card p-8 lg:p-10 w-full">
            <span class="label text-gold block mb-4">[open]</span>
            <h3 class="text-foreground text-xl font-medium">All levels welcome</h3>
            <p class="text-muted mt-3">
              New to lacrosse or played in college — just show up.
              No commitment required.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact" class="snap-section section-full relative overflow-hidden">
    <!-- Topographic contour lines - SF hills -->
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <!-- Secondary contour from bottom-left -->
      <div class="absolute -bottom-[150px] -left-[150px] w-[400px] h-[400px] rounded-full border border-powder/15"></div>
      <div class="absolute -bottom-[150px] -left-[150px] w-[520px] h-[520px] rounded-full border border-powder/12"></div>
      <div class="absolute -bottom-[150px] -left-[150px] w-[640px] h-[640px] rounded-full border border-powder/10"></div>
      <!-- Primary contour from top-right -->
      <div class="absolute -top-[250px] -right-[250px] w-[600px] h-[600px] rounded-full border border-powder/20"></div>
      <div class="absolute -top-[250px] -right-[250px] w-[750px] h-[750px] rounded-full border border-powder/15"></div>
      <div class="absolute -top-[250px] -right-[250px] w-[900px] h-[900px] rounded-full border border-powder/20"></div>
      <div class="absolute -top-[250px] -right-[250px] w-[1050px] h-[1050px] rounded-full border border-powder/10"></div>
    </div>

    <!-- Corner L-brackets -->
    <div class="absolute top-8 left-8 w-8 h-8 border-t border-l border-powder/30 hidden lg:block" aria-hidden="true"></div>
    <div class="absolute bottom-8 right-8 w-8 h-8 border-b border-r border-powder/30 hidden lg:block" aria-hidden="true"></div>

    <div class="max-w-6xl mx-auto px-6 lg:px-16 relative">
      <div class="max-w-2xl reveal">
        <span class="label text-powder/60 block mb-2">ref. 004</span>
        <span class="label text-powder">[connect]</span>
        <h2 class="text-foreground mt-2 text-4xl sm:text-5xl font-medium tracking-tight">Get in touch</h2>

        <div class="mt-12 space-y-8">
          <div>
            <span class="label text-subtle block mb-2">[email]</span>
            <a
              href="mailto:info@barbarycoastlax.com"
              class="text-2xl font-medium text-foreground hover:text-powder transition-colors"
            >
              info@barbarycoastlax.com
            </a>
          </div>

          <div>
            <span class="label text-subtle block mb-2">[instagram]</span>
            <a
              href="https://www.instagram.com/barbarycoastlc/"
              target="_blank"
              rel="noopener noreferrer"
              class="text-2xl font-medium text-foreground hover:text-gold transition-colors"
            >
              @barbarycoastlc
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Marquee at bottom of contact section -->
    <div class="absolute bottom-0 left-0 right-0 marquee border-t border-border py-4 bg-surface/80 backdrop-blur-sm">
      <div class="marquee-content">
        {[...Array(3)].map(() => (
          <div class="flex items-center gap-12 px-6">
            <span class="label text-muted whitespace-nowrap">Barbary Coast</span>
            <span class="w-1 h-1 bg-powder"></span>
            <span class="label text-muted whitespace-nowrap">Beach Chalet Fields</span>
            <span class="w-1 h-1 bg-gold"></span>
            <span class="label text-muted whitespace-nowrap">Est. 2024</span>
            <span class="w-1 h-1 bg-powder"></span>
            <span class="label text-muted whitespace-nowrap">San Francisco</span>
            <span class="w-1 h-1 bg-gold"></span>
          </div>
        ))}
      </div>
    </div>
  </section>
</Layout>

<script>
  // Section Observer for timeline navigation
  const sections = document.querySelectorAll('section[id]');
  const timelineItems = document.querySelectorAll<HTMLAnchorElement>('.timeline-item[data-section]');

  const sectionObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.id;

          // Update timeline items
          timelineItems.forEach(item => {
            item.classList.toggle('active', item.dataset.section === sectionId);
          });
        }
      });
    },
    { threshold: 0.5 }
  );

  sections.forEach((section) => sectionObserver.observe(section));

  // Reveal animations
  const revealObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const el = entry.target as HTMLElement;
          const delay = getComputedStyle(el).getPropertyValue('--delay') || '0s';
          el.style.animationDelay = delay;
          el.classList.add('visible');
          revealObserver.unobserve(el);
        }
      });
    },
    { threshold: 0.1, rootMargin: '0px 0px -80px 0px' }
  );

  document.querySelectorAll('.reveal').forEach((el) => revealObserver.observe(el));

  // Keyboard navigation between sections
  const snapContainer = document.getElementById('main');
  const sectionIds = ['hero', 'schedule', 'practice', 'contact'];

  function getCurrentSectionIndex(): number {
    if (!snapContainer) return 0;
    const scrollTop = snapContainer.scrollTop;
    const sectionHeight = snapContainer.clientHeight;
    return Math.round(scrollTop / sectionHeight);
  }

  function scrollToSection(index: number) {
    if (!snapContainer) return;
    const clampedIndex = Math.max(0, Math.min(index, sectionIds.length - 1));
    const section = document.getElementById(sectionIds[clampedIndex]);
    if (section) {
      snapContainer.scrollTo({
        top: section.offsetTop,
        behavior: 'smooth'
      });
    }
  }

  // Hotkey map for section navigation
  const hotkeyMap: Record<string, string> = {
    'h': 'hero',
    's': 'schedule',
    'p': 'practice',
    'c': 'contact'
  };

  // Hotkey map for page navigation
  const pageHotkeyMap: Record<string, string> = {
    'f': '/schedule',
    'y': '/history'
  };

  document.addEventListener('keydown', (e) => {
    // Don't hijack if user is typing in an input
    if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) return;

    // Arrow key navigation
    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
      e.preventDefault();
      const current = getCurrentSectionIndex();
      scrollToSection(e.key === 'ArrowUp' ? current - 1 : current + 1);
      return;
    }

    // Hotkey navigation - sections
    const sectionId = hotkeyMap[e.key.toLowerCase()];
    if (sectionId) {
      e.preventDefault();
      const index = sectionIds.indexOf(sectionId);
      if (index !== -1) {
        scrollToSection(index);
      }
      return;
    }

    // Hotkey navigation - pages
    const pagePath = pageHotkeyMap[e.key.toLowerCase()];
    if (pagePath) {
      e.preventDefault();
      window.location.href = pagePath;
    }
  });

  // Custom lacrosse ball cursor
  const cursor = document.getElementById('ball-cursor');
  const isTouch = window.matchMedia('(hover: none)').matches;

  if (cursor && !isTouch) {
    document.body.classList.add('custom-cursor');

    let cursorX = 0;
    let cursorY = 0;
    let targetX = 0;
    let targetY = 0;

    document.addEventListener('mousemove', (e) => {
      targetX = e.clientX;
      targetY = e.clientY;
      cursor.style.opacity = '1';

      // Check if hovering over interactive element
      const target = e.target as HTMLElement;
      const isInteractive = target.closest('a, button, [role="button"], input, textarea, select, .timeline-item');
      cursor.classList.toggle('hovering', !!isInteractive);
    });

    document.addEventListener('mouseleave', () => {
      cursor.style.opacity = '0';
    });

    document.addEventListener('mousedown', () => {
      cursor.classList.add('pressing');
    });

    document.addEventListener('mouseup', () => {
      cursor.classList.remove('pressing');
    });

    // Smooth animation loop
    function animate() {
      cursorX += (targetX - cursorX) * 0.15;
      cursorY += (targetY - cursorY) * 0.15;
      cursor.style.left = `${cursorX}px`;
      cursor.style.top = `${cursorY}px`;
      requestAnimationFrame(animate);
    }
    animate();
  }
</script>
